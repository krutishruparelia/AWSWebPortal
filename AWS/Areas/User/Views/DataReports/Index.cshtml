
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <div class="card-header">
        Report View
    </div>
    <div class="card-body" id="form-container">
        <form>
            <div class="form-group row">
                <label for="input-22" class="col-sm-2 col-form-label">From Date</label>
                <div class="col-sm-10">
                    <div id="FromDate" class="form-control"></div>
                </div>
            </div>
            <div class="form-group row">
                <label for="input-21" class="col-sm-2 col-form-label">To Date</label>
                <div class="col-sm-10">
                    <div id="Todate" class="form-control"></div>
                </div>
            </div>

            <div class="form-group row">
                <label for="input-23" class="col-sm-2 col-form-label">Select Station</label>
                <div class="col-sm-10">
                    <div id="lookup"></div>
                </div>
            </div>
            <div class="form-group row" style="margin-left:37%">
                <div id="default-contained"></div>
            </div>
            <div id="gridshow"></div>
        </form>
    </div>
</div>

<script>
    var Rdata = "";

    var StationList = @Html.Raw(Json.Encode(ViewBag.stationSql));
    $("#Todate").dxDateBox({
        name:"Todate",
        type: "date",
        displayFormat: "dd/MM/yyy",
    });
    $("#FromDate").dxDateBox({
        type: "date",
        displayFormat: "dd/MM/yyy",
    });
    $("#lookup").dxLookup({
        items: StationList,
        showPopupTitle: false,
        validationRules: [{ type: "required" }],
    });
    $("#default-contained").dxButton({
        stylingMode: "contained",
        text: "Generate Report",
        type: "default",

        onClick: function () {
            var toDate = $("#Todate").dxDateBox('option', 'value')
            var fromDate = $("#FromDate").dxDateBox('option', 'value')
            var stationName = $("#lookup").dxLookup('option', 'value')

            $.ajax({
                url: "/User/Reports/ReportGetData",
                dataType: "json",
                data: { "toDate": toDate, "fromDate": fromDate, "stationName": stationName},
                success: function (result) {
                    var data = result;
                    var parsejson = JSON.parse(data);
                    Rdata = data;
                    datagridshow(Rdata);
                }
            });
            ////$("#Todate").dxTextbox("dispose");
            ////$("#form-container").submit();
            ////datagridshow();
            ////DevExpress.ui.notify("The Contained button was clicked");
        }
    });

    function datagridshow(Rdata) {
        var jsonformated = JSON.parse(Rdata);
        var ToDate = new Date($("#Todate").dxDateBox('option', 'value'));
        var tdate = ToDate.getDate() + "-" + ToDate.getMonth() + "-" + ToDate.getFullYear();
        var frmDate = new Date($("#FromDate").dxDateBox('option', 'value'));
        var fdate = frmDate.getDate() + "-" + frmDate.getMonth() + "-" + frmDate.getFullYear();
        fdate = fdate.slice(1, 11)
        $("#gridshow").dxDataGrid({
            dataSource: JSON.parse(Rdata),
            showBorders: true,
            selection: {
                mode: "multiple"
            },
            "export": {
                enabled: true,
                fileName: $("#lookup").dxLookup('option', 'value')+"-"+jsonformated[0].StationID + "-" + fdate + "to" + tdate,
                allowExportSelectedData: true
            },
            groupPanel: {
                visible: true
            },

        });
    }
</script>

